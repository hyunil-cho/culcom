{{define "dashboard/home.html"}}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Title}} - ë°±ì˜¤í”¼ìŠ¤</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    {{template "sidebar" .}}
    
    <div class="main-wrapper">
        {{template "header" .}}
        
        <main class="content">
<!-- í†µê³„ ì¹´ë“œ ê·¸ë¦¬ë“œ -->
<div class="stats-grid">
    {{range .Stats}}
    <div class="stat-card" style="border-left: 4px solid {{.Color}}">
        <div class="stat-icon">{{.Icon}}</div>
        <div class="stat-info">
            <div class="stat-title">{{.Title}}</div>
            <div class="stat-value">{{.Value}}</div>
        </div>
    </div>
    {{end}}
</div>

<!-- ì½˜í…ì¸  ì„¹ì…˜ -->
<div class="content-grid">
    <div class="content-card">
        <div class="card-header">
            <h3>ğŸ“ˆ ìµœê·¼ 7ì¼ ì˜ˆì•½ì ì¶”ì´</h3>
        </div>
        <div class="card-body">
            <canvas id="dailyStatsChart" style="max-height: 300px;"></canvas>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script>
// ì¼ë³„ í†µê³„ ë°ì´í„°
let dailyStatsData = [];
try {
    const rawData = '{{.DailyStatsJSON}}';
    dailyStatsData = JSON.parse(rawData);
    if (!Array.isArray(dailyStatsData)) {
        console.warn('dailyStatsData is not an array:', dailyStatsData);
        dailyStatsData = [];
    }
    console.log('ğŸ“Š ì¼ë³„ í†µê³„ ë°ì´í„°:', dailyStatsData);
} catch (e) {
    console.error('Failed to parse dailyStatsData:', e);
    dailyStatsData = [];
}

// Chart.js ê·¸ë˜í”„ ìƒì„±
const ctx = document.getElementById('dailyStatsChart');
if (ctx && dailyStatsData.length > 0) {
    // ë°ì´í„° ê°€ê³µ
    const labels = dailyStatsData.map(item => {
        const date = new Date(item.date);
        const month = date.getMonth() + 1;
        const day = date.getDate();
        return `${month}/${day}`;
    });
    
    const customerCounts = dailyStatsData.map(item => item.count);
    const reservationCounts = dailyStatsData.map(item => item.reservationCount);
    
    console.log('ğŸ“… ë‚ ì§œ ë¼ë²¨:', labels);
    console.log('ğŸ‘¥ ì˜ˆì•½ì ìˆ˜:', customerCounts);
    console.log('âœ… ì˜ˆì•½ í™•ì •ì ìˆ˜:', reservationCounts);
    
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [
                {
                    label: 'ì˜ˆì•½ì ìˆ˜',
                    data: customerCounts,
                    borderColor: '#3498db',
                    backgroundColor: 'rgba(52, 152, 219, 0.1)',
                    borderWidth: 2,
                    fill: true,
                    tension: 0.3,
                    pointRadius: 4,
                    pointBackgroundColor: '#3498db',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                    pointHoverRadius: 6
                },
                {
                    label: 'ì˜ˆì•½ í™•ì •ì ìˆ˜',
                    data: reservationCounts,
                    borderColor: '#2ecc71',
                    backgroundColor: 'rgba(46, 204, 113, 0.1)',
                    borderWidth: 2,
                    fill: true,
                    tension: 0.3,
                    pointRadius: 4,
                    pointBackgroundColor: '#2ecc71',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                    pointHoverRadius: 6
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: {
                    display: true,
                    position: 'top',
                },
                tooltip: {
                    mode: 'index',
                    intersect: false,
                    callbacks: {
                        label: function(context) {
                            const label = context.dataset.label || '';
                            const value = context.parsed.y;
                            return label + ': ' + value + 'ëª…';
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        stepSize: 1,
                        callback: function(value) {
                            return value + 'ëª…';
                        }
                    },
                    grid: {
                        color: 'rgba(0, 0, 0, 0.05)'
                    }
                },
                x: {
                    grid: {
                        display: false
                    }
                }
            },
            interaction: {
                mode: 'nearest',
                axis: 'x',
                intersect: false
            }
        }
    });
} else if (ctx && dailyStatsData.length === 0) {
    // ë°ì´í„°ê°€ ì—†ì„ ê²½ìš° ë©”ì‹œì§€ í‘œì‹œ
    ctx.parentElement.innerHTML = '<div style="text-align: center; padding: 60px 20px; color: #999;">ìµœê·¼ 7ì¼ê°„ ì˜ˆì•½ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
}
</script>
        </main>
    </div>
</body>
</html>
{{end}}
