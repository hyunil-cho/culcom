{{define "message-templates/list.html"}}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Title}} - ë°±ì˜¤í”¼ìŠ¤</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <style>
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .page-header h1 {
            margin: 0;
            font-size: 28px;
            color: #333;
        }

        .btn-add {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn-add:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .success-message {
            background: #e8f5e9;
            border: 1px solid #4caf50;
            color: #2e7d32;
            padding: 12px 16px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none;
        }

        .success-message.show {
            display: block;
        }

        .filter-section {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 1px solid #e0e0e0;
            background: white;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .filter-btn:hover,
        .filter-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .templates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 20px;
        }

        .template-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            position: relative;
        }

        .template-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .template-card.inactive {
            opacity: 0.6;
        }

        .template-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 12px;
        }

        .template-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin: 0 0 4px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .default-badge {
            display: inline-flex;
            align-items: center;
            padding: 3px 10px;
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #8b6914;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            box-shadow: 0 2px 4px rgba(255, 215, 0, 0.3);
        }

        .template-category {
            display: inline-block;
            padding: 4px 12px;
            background: #e3f2fd;
            color: #1976d2;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .template-status {
            position: absolute;
            top: 16px;
            right: 16px;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        .template-status.active {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .template-status.inactive {
            background: #f5f5f5;
            color: #666;
        }

        .template-description {
            color: #666;
            font-size: 13px;
            margin: 8px 0 12px 0;
            line-height: 1.4;
        }

        .template-content {
            background: #f9f9f9;
            border-left: 3px solid #667eea;
            padding: 12px;
            border-radius: 4px;
            font-size: 14px;
            line-height: 1.6;
            color: #333;
            margin: 12px 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .placeholder {
            background: #fff3e0;
            color: #e65100;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 13px;
        }

        .template-meta {
            display: flex;
            gap: 16px;
            font-size: 12px;
            color: #999;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #f0f0f0;
        }

        .template-actions {
            display: flex;
            gap: 8px;
            margin-top: 16px;
        }

        .btn-action {
            flex: 1;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            text-decoration: none;
            display: inline-block;
        }

        .btn-edit {
            background: #2196f3;
            color: white;
        }

        .btn-edit:hover {
            background: #1976d2;
        }

        .btn-delete {
            background: #f44336;
            color: white;
        }

        .btn-delete:hover {
            background: #d32f2f;
        }

        .btn-preview {
            background: #4caf50;
            color: white;
        }

        .btn-preview:hover {
            background: #45a049;
        }

        .btn-set-default {
            background: #ffc107;
            color: #333;
        }

        .btn-set-default:hover {
            background: #ffb300;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        .empty-state h3 {
            margin: 0 0 8px 0;
            color: #666;
        }

        /* í˜ì´ì§• ìŠ¤íƒ€ì¼ */
        .pagination-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 40px;
            gap: 8px;
        }

        .pagination-info {
            color: #666;
            font-size: 14px;
            margin-right: 20px;
        }

        .pagination {
            display: flex;
            gap: 6px;
            align-items: center;
        }

        .page-btn {
            padding: 8px 14px;
            border: 1px solid #e0e0e0;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #666;
            text-decoration: none;
            transition: all 0.2s;
            min-width: 38px;
            text-align: center;
        }

        .page-btn:hover:not(.active):not(:disabled) {
            background: #f5f5f5;
            border-color: #667eea;
            color: #667eea;
        }

        .page-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .page-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .page-btn.arrow {
            font-weight: 600;
        }
    </style>
</head>
<body>
    {{template "sidebar" .}}
    
    <div class="main-wrapper">
        {{template "header" .}}
        
        <main class="content">
            <!-- í˜ì´ì§€ í—¤ë” -->
            <div class="page-header">
                <h1>ğŸ“ ë©”ì‹œì§€ í…œí”Œë¦¿ ê´€ë¦¬</h1>
                <a href="/message-templates/add" class="btn-add">
                    â• ìƒˆ í…œí”Œë¦¿ ë§Œë“¤ê¸°
                </a>
            </div>

            <!-- ì„±ê³µ ë©”ì‹œì§€ -->
            <div id="successMessage" class="success-message"></div>

            <!-- í•„í„° ì„¹ì…˜ -->
            <div class="filter-section">
                {{range .Categories}}
                <button class="filter-btn {{if eq . "ì „ì²´"}}active{{end}}" onclick="filterByCategory('{{.}}')">
                    {{.}}
                </button>
                {{end}}
            </div>

            <!-- í…œí”Œë¦¿ ê·¸ë¦¬ë“œ -->
            <div class="templates-grid" id="templatesGrid">
                {{if .Templates}}
                    {{range .Templates}}
                    <div class="template-card {{if not .IsActive}}inactive{{end}}" data-category="{{.Category}}">
                        <div class="template-header">
                            <div>
                                <h3 class="template-title">
                                    {{.Name}}
                                    {{if .IsDefault}}<span class="default-badge">â­ ê¸°ë³¸</span>{{end}}
                                </h3>
                                <span class="template-category">{{.Category}}</span>
                            </div>
                        </div>
                        <span class="template-status {{if .IsActive}}active{{else}}inactive{{end}}">
                            {{if .IsActive}}ì‚¬ìš© ì¤‘{{else}}ë¹„í™œì„±{{end}}
                        </span>
                        
                        <p class="template-description">{{.Description}}</p>
                        
                        <div class="template-content">
                            {{.Content}}
                        </div>

                        <div class="template-meta">
                            <span>ğŸ• ìƒì„±: {{.CreatedAt}}</span>
                            <span>ğŸ“ ìˆ˜ì •: {{.UpdatedAt}}</span>
                        </div>

                        <div class="template-actions">
                            {{if not .IsDefault}}
                            <button class="btn-action btn-set-default" onclick="setAsDefault({{.ID}}, '{{.Name}}')">
                                â­ ê¸°ë³¸ê°’ ì„¤ì •
                            </button>
                            {{end}}
                            <button class="btn-action btn-preview" onclick="previewTemplate({{.ID}})">
                                ğŸ‘ï¸ ë¯¸ë¦¬ë³´ê¸°
                            </button>
                            <a href="/message-templates/edit?id={{.ID}}" class="btn-action btn-edit">
                                âœï¸ ìˆ˜ì •
                            </a>
                            <button class="btn-action btn-delete" onclick="deleteTemplate({{.ID}}, '{{.Name}}')">
                                ğŸ—‘ï¸ ì‚­ì œ
                            </button>
                        </div>
                    </div>
                    {{end}}
                {{else}}
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“­</div>
                        <h3>ë“±ë¡ëœ í…œí”Œë¦¿ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p>ìƒˆ í…œí”Œë¦¿ì„ ë§Œë“¤ì–´ ë©”ì‹œì§€ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ì„¸ìš”</p>
                    </div>
                {{end}}
            </div>

            <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
            {{if gt .Pagination.TotalPages 1}}
            <div class="pagination-container">
                <div class="pagination">
                    <!-- ì´ì „ í˜ì´ì§€ -->
                    {{if .Pagination.HasPrev}}
                        <a href="?page={{printf "%d" (sub .Pagination.CurrentPage 1)}}" class="page-btn page-arrow">
                            â—€
                        </a>
                    {{else}}
                        <span class="page-btn page-arrow disabled">â—€</span>
                    {{end}}

                    <!-- í˜ì´ì§€ ë²ˆí˜¸ -->
                    {{range .Pagination.Pages}}
                        {{if eq . $.Pagination.CurrentPage}}
                            <span class="page-btn active">{{.}}</span>
                        {{else}}
                            <a href="?page={{.}}" class="page-btn">{{.}}</a>
                        {{end}}
                    {{end}}

                    <!-- ë‹¤ìŒ í˜ì´ì§€ -->
                    {{if .Pagination.HasNext}}
                        <a href="?page={{printf "%d" (add $.Pagination.CurrentPage 1)}}" class="page-btn page-arrow">
                            â–¶
                        </a>
                    {{else}}
                        <span class="page-btn page-arrow disabled">â–¶</span>
                    {{end}}
                </div>
                
                <div style="text-align: center; margin-top: 15px; color: #666; font-size: 14px;">
                    {{.Pagination.CurrentPage}} / {{.Pagination.TotalPages}} í˜ì´ì§€ (ì´ {{.Pagination.TotalItems}}ê°œ)
                </div>
            </div>
            {{end}}

        </main>
    </div>

    <script>
        // URL íŒŒë¼ë¯¸í„°ë¡œ ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
        window.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const success = urlParams.get('success');
            const successMessage = document.getElementById('successMessage');
            
            if (success === 'add') {
                successMessage.textContent = 'âœ… ìƒˆ í…œí”Œë¦¿ì´ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.';
                successMessage.classList.add('show');
            } else if (success === 'edit') {
                successMessage.textContent = 'âœ… í…œí”Œë¦¿ì´ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.';
                successMessage.classList.add('show');
            } else if (success === 'delete') {
                successMessage.textContent = 'âœ… í…œí”Œë¦¿ì´ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.';
                successMessage.classList.add('show');
            } else if (success === 'default') {
                successMessage.textContent = 'â­ ê¸°ë³¸ í…œí”Œë¦¿ì´ ì„±ê³µì ìœ¼ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.';
                successMessage.classList.add('show');
            }
            
            if (success) {
                setTimeout(function() {
                    successMessage.classList.remove('show');
                }, 3000);
                
                // URLì—ì„œ íŒŒë¼ë¯¸í„° ì œê±°
                window.history.replaceState({}, '', '/message-templates');
            }
        });

        // ì¹´í…Œê³ ë¦¬ í•„í„°ë§
        function filterByCategory(category) {
            const cards = document.querySelectorAll('.template-card');
            const buttons = document.querySelectorAll('.filter-btn');
            
            // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
            buttons.forEach(btn => {
                if (btn.textContent.trim() === category) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            // ì¹´ë“œ í•„í„°ë§
            cards.forEach(card => {
                if (category === 'ì „ì²´' || card.dataset.category === category) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // í…œí”Œë¦¿ ë¯¸ë¦¬ë³´ê¸°
        function previewTemplate(id) {
            // TODO: ì‹¤ì œ êµ¬í˜„ ì‹œ ëª¨ë‹¬ë¡œ ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
            alert('í…œí”Œë¦¿ ë¯¸ë¦¬ë³´ê¸° ê¸°ëŠ¥\n(ì‹¤ì œ êµ¬í˜„ ì‹œ í”Œë ˆì´ìŠ¤í™€ë”ì— ìƒ˜í”Œ ë°ì´í„°ë¥¼ ì ìš©í•œ ë¯¸ë¦¬ë³´ê¸°ë¥¼ ëª¨ë‹¬ë¡œ í‘œì‹œ)');
        }

        // í…œí”Œë¦¿ ì‚­ì œ
        function deleteTemplate(id, name) {
            if (confirm(`"${name}" í…œí”Œë¦¿ì„ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) {
                // í¼ ìƒì„± ë° ì œì¶œ
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = '/message-templates/delete?id=' + id;
                document.body.appendChild(form);
                form.submit();
            }
        }

        // ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •
        function setAsDefault(id, name) {
            if (confirm(`"${name}" í…œí”Œë¦¿ì„ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nê¸°ì¡´ ê¸°ë³¸ê°’ì€ ìë™ìœ¼ë¡œ í•´ì œë©ë‹ˆë‹¤.`)) {
                // í¼ ìƒì„± ë° ì œì¶œ
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = '/message-templates/set-default?id=' + id;
                document.body.appendChild(form);
                form.submit();
            }
        }
    </script>
</body>
</html>
{{end}}
