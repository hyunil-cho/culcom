{{define "header"}}
<header class="top-header">
    <div class="header-left">
        <h1>{{.Title}}</h1>
    </div>
    <div class="header-right">
        <div class="branch-selector" style="margin-right: 2rem;">
            <label style="margin-right: 0.5rem; color: #5a6c7d; font-size: 0.9rem;">ì§€ì  ì„ íƒ:</label>
            <select id="branchSelect" onchange="changeBranch(this.value)" style="padding: 0.5rem 1rem; border: 1px solid #ddd; border-radius: 6px; font-size: 0.9rem; cursor: pointer; background: white;">
                <option value="gasan" selected>ê°€ì‚°</option>
                <option value="gangnam">ê°•ë‚¨</option>
                <option value="hongdae">í™ëŒ€</option>
                <option value="sinchon">ì‹ ì´Œ</option>
                <option value="">ì „ì²´</option>
            </select>
        </div>
        <div class="user-info">
            <span class="user-avatar">ğŸ‘¤</span>
            <span class="user-name">ê´€ë¦¬ì</span>
            <a href="/" class="logout-btn">ë¡œê·¸ì•„ì›ƒ</a>
        </div>
    </div>
</header>

<script>
// ì˜ë¬¸ ì½”ë“œ -> í•œê¸€ ì´ë¦„ ë§¤í•‘
const branchNames = {
    'gasan': 'ê°€ì‚°',
    'gangnam': 'ê°•ë‚¨',
    'hongdae': 'í™ëŒ€',
    'sinchon': 'ì‹ ì´Œ'
};

function changeBranch(branchCode) {
    // localStorageì— ì˜ë¬¸ ì½”ë“œë¡œ ì €ì¥
    if (branchCode === '') {
        localStorage.removeItem('selectedBranch');
    } else {
        localStorage.setItem('selectedBranch', branchCode);
    }
    
    // í˜„ì¬ URLì— ì§€ì  íŒŒë¼ë¯¸í„° ì¶”ê°€í•˜ì—¬ í˜ì´ì§€ ë¦¬ë¡œë“œ
    const currentUrl = new URL(window.location.href);
    
    if (branchCode === '') {
        currentUrl.searchParams.delete('branch');
    } else {
        currentUrl.searchParams.set('branch', branchCode);
    }
    
    // í˜ì´ì§€ ë¦¬ë¡œë“œ
    window.location.href = currentUrl.toString();
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ ì§€ì  ë³µì›
document.addEventListener('DOMContentLoaded', function() {
    const urlParams = new URLSearchParams(window.location.search);
    const urlBranch = urlParams.get('branch');
    const savedBranch = localStorage.getItem('selectedBranch');
    const branchSelect = document.getElementById('branchSelect');
    const sidebarTitle = document.querySelector('.sidebar-header h2');
    
    // URL íŒŒë¼ë¯¸í„°ê°€ ìˆìœ¼ë©´ ìš°ì„  ì‚¬ìš© (ê¸°ë³¸ê°’ì€ ì˜ë¬¸ ì½”ë“œ 'gasan')
    let currentBranch = urlBranch || savedBranch || 'gasan';
    
    // URLê³¼ localStorage ë™ê¸°í™”
    if (!urlBranch && savedBranch) {
        // URLì— ì§€ì  íŒŒë¼ë¯¸í„° ì—†ìœ¼ë©´ ì¶”ê°€
        const currentUrl = new URL(window.location.href);
        currentUrl.searchParams.set('branch', savedBranch);
        window.history.replaceState({}, '', currentUrl.toString());
        currentBranch = savedBranch;
    } else if (urlBranch) {
        // URL íŒŒë¼ë¯¸í„°ë¡œ localStorage ì—…ë°ì´íŠ¸
        localStorage.setItem('selectedBranch', urlBranch);
        currentBranch = urlBranch;
    }
    
    // ë“œë¡­ë‹¤ìš´ ì„ íƒ ìƒíƒœ ì„¤ì • (ì˜ë¬¸ ì½”ë“œ)
    if (branchSelect) {
        branchSelect.value = currentBranch || '';
    }
    
    // ì‚¬ì´ë“œë°” ì œëª© ì—…ë°ì´íŠ¸ (í•œê¸€ ì´ë¦„ìœ¼ë¡œ í‘œì‹œ)
    if (sidebarTitle) {
        if (currentBranch && currentBranch !== '') {
            const branchDisplayName = branchNames[currentBranch] || currentBranch;
            sidebarTitle.textContent = `ğŸ¢ ${branchDisplayName}-ë°±ì˜¤í”¼ìŠ¤`;
        } else {
            sidebarTitle.textContent = 'ğŸ¢ ë°±ì˜¤í”¼ìŠ¤!!';
        }
    }
});
</script>
{{end}}
