{{define "header"}}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Title}} - ë°±ì˜¤í”¼ìŠ¤</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <script>
    // ì§€ì  ì •ë³´ ì „ì—­ ë³€ìˆ˜ (í˜ì´ì§€ ë¡œë“œ ì´ˆê¸°ì— ì„¤ì •)
        window.branchInfo = {
            name: '{{.SelectedBranchName}}',
            manager: '{{.SelectedBranchManager}}',
            address: '{{.SelectedBranchAddress}}',
            directions: '{{.SelectedBranchDirections}}'
        };
        console.log('ğŸ¢ Dashboard - Branch Info Initialized:', window.branchInfo);
    </script>
    <script src="/static/js/template-utils.js"></script>
    <script src="/static/js/modal-manager.js"></script>
<header class="top-header">
    
    <div class="header-left">
        <h1>{{.Title}}</h1>
    </div>
    <div class="header-right">
        <div class="branch-selector" style="margin-right: 2rem;">
            <label style="margin-right: 0.5rem; color: #5a6c7d; font-size: 0.9rem;">ì§€ì  ì„ íƒ:</label>
            <select id="branchSelect" onchange="changeBranch(this.value)" style="padding: 0.5rem 1rem; border: 1px solid #ddd; border-radius: 6px; font-size: 0.9rem; cursor: pointer; background: white;">
                {{if .BranchList}}
                    {{range .BranchList}}
                        <option value="{{.alias}}" {{if eq .alias $.SelectedBranch}}selected{{end}}>{{.name}}</option>
                    {{end}}
                {{else}}
                    <option value="">ì§€ì  ì—†ìŒ</option>
                {{end}}
            </select>
        </div>
        <div class="user-info">
            <span class="user-avatar">ğŸ‘¤</span>
            <span class="user-name">ê´€ë¦¬ì</span>
            <a href="javascript:void(0);" class="logout-btn" onclick="showLogoutModal()">ë¡œê·¸ì•„ì›ƒ</a>
        </div>
    </div>
</header>

<script>
// ë¡œê·¸ì•„ì›ƒ ëª¨ë‹¬ í‘œì‹œ
function showLogoutModal() {
    // ê¸°ì¡´ ëª¨ë‹¬ì´ ìˆìœ¼ë©´ ì œê±°
    const existingModal = document.getElementById('logoutModal');
    if (existingModal) {
        existingModal.remove();
    }

    // ëª¨ë‹¬ HTML ìƒì„±
    const modalHTML = `
        <div id="logoutModal" style="display: flex; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 10000; align-items: center; justify-content: center;">
            <div style="background: white; border-radius: 12px; width: 90%; max-width: 400px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);">
                <div style="padding: 1.5rem 2rem; border-bottom: 2px solid #4a90e2;">
                    <h3 style="margin: 0; font-size: 1.25rem; color: #2c3e50;">ë¡œê·¸ì•„ì›ƒ í™•ì¸</h3>
                </div>
                <div style="padding: 2rem; text-align: center; color: #666; font-size: 0.95rem;">
                    ì •ë§ë¡œ ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?
                </div>
                <div style="padding: 1rem 2rem; border-top: 1px solid #e0e0e0; display: flex; gap: 0.75rem;">
                    <button onclick="closeLogoutModal()" style="flex: 1; padding: 0.75rem; font-size: 1rem; border: 1px solid #ddd; background: white; color: #666; border-radius: 6px; cursor: pointer;">ì·¨ì†Œ</button>
                    <button onclick="confirmLogout()" style="flex: 1; padding: 0.75rem; font-size: 1rem; border: none; background: #4a90e2; color: white; border-radius: 6px; cursor: pointer;">í™•ì¸</button>
                </div>
            </div>
        </div>
    `;

    // ëª¨ë‹¬ì„ bodyì— ì¶”ê°€
    document.body.insertAdjacentHTML('beforeend', modalHTML);

    // ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
    document.getElementById('logoutModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeLogoutModal();
        }
    });
}

function closeLogoutModal() {
    const modal = document.getElementById('logoutModal');
    if (modal) {
        modal.remove();
    }
}

function confirmLogout() {
    window.location.href = '/logout';
}

function changeBranch(branchCode) {
    // localStorageì— ì˜ë¬¸ ì½”ë“œë¡œ ì €ì¥ (í´ë¼ì´ì–¸íŠ¸ ì¸¡ ë³µì›ìš©)
    if (branchCode === '') {
        localStorage.removeItem('selectedBranch');
    } else {
        localStorage.setItem('selectedBranch', branchCode);
    }
    
    // í˜„ì¬ URLì— ì§€ì  íŒŒë¼ë¯¸í„° ì¶”ê°€í•˜ì—¬ í˜ì´ì§€ ë¦¬ë¡œë“œ (ì„œë²„ì—ì„œ ì„¸ì…˜ì— ì €ì¥í•¨)
    const currentUrl = new URL(window.location.href);
    
    if (branchCode === '') {
        currentUrl.searchParams.delete('branch');
    } else {
        currentUrl.searchParams.set('branch', branchCode);
    }
    
    // í˜ì´ì§€ ë¦¬ë¡œë“œ
    window.location.href = currentUrl.toString();
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ ì§€ì  ë³µì›
document.addEventListener('DOMContentLoaded', function() {
    const urlParams = new URLSearchParams(window.location.search);
    const urlBranch = urlParams.get('branch');
    const savedBranch = localStorage.getItem('selectedBranch');
    const branchSelect = document.getElementById('branchSelect');
    const sidebarTitle = document.querySelector('.sidebar-header h2');
    
    // URL íŒŒë¼ë¯¸í„°ê°€ ìˆìœ¼ë©´ ìš°ì„  ì‚¬ìš© (ê¸°ë³¸ê°’ì€ ì˜ë¬¸ ì½”ë“œ 'gasan')
    let currentBranch = urlBranch || savedBranch || 'gasan';
    
    // URLê³¼ localStorage ë™ê¸°í™”
    if (!urlBranch && savedBranch) {
        // URLì— ì§€ì  íŒŒë¼ë¯¸í„° ì—†ìœ¼ë©´ ì¶”ê°€
        const currentUrl = new URL(window.location.href);
        currentUrl.searchParams.set('branch', savedBranch);
        window.history.replaceState({}, '', currentUrl.toString());
        currentBranch = savedBranch;
    } else if (urlBranch) {
        // URL íŒŒë¼ë¯¸í„°ë¡œ localStorage ì—…ë°ì´íŠ¸
        localStorage.setItem('selectedBranch', urlBranch);
        currentBranch = urlBranch;
    }
    
    // ë“œë¡­ë‹¤ìš´ ì„ íƒ ìƒíƒœ ì„¤ì • (ì˜ë¬¸ ì½”ë“œ)
    if (branchSelect) {
        branchSelect.value = currentBranch || '';
    }
    
    // ì‚¬ì´ë“œë°” ì œëª© ì—…ë°ì´íŠ¸ (ì„œë²„ì—ì„œ ì „ë‹¬ë°›ì€ í•œê¸€ ì´ë¦„ ì‚¬ìš©)
    if (sidebarTitle) {
        const branchName = '{{.SelectedBranchName}}';
        if (branchName && branchName !== '') {
            sidebarTitle.textContent = `ğŸ¢ ${branchName}-ë°±ì˜¤í”¼ìŠ¤`;
        } else {
            sidebarTitle.textContent = 'ğŸ¢ ë°±ì˜¤í”¼ìŠ¤!!';
        }
    }
});
</script>
{{end}}
