{{define "representative-modal"}}
<!-- ëŒ€í‘œì ì„ íƒ ëª¨ë‹¬ -->
<div id="representativeModal" class="modal">
    <div class="modal-content" style="max-width: 800px; max-height: 85vh; display: flex; flex-direction: column;">
        <div class="modal-header" style="padding: 20px;">
            <h3>ëŒ€í‘œì ì„ íƒ</h3>
            <span class="modal-close" onclick="closeRepresentativeModal()">&times;</span>
        </div>
        <div class="modal-body" style="padding: 0 20px; overflow-y: auto; flex: 1;">
            <div class="search-section" style="margin-bottom: 20px; padding-top: 10px;">
                <div class="search-filters" style="display: flex; align-items: center; gap: 10px;">
                    <select id="representativeSearchColumn" class="search-input" style="width: 150px; height: 40px; padding: 8px;">
                        <option value="name">ì´ë¦„</option>
                        <option value="alias">ë³„ëª…</option>
                        <option value="phone">ì „í™”ë²ˆí˜¸</option>
                    </select>
                    <input type="text" id="representativeSearch" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”" class="search-input" style="flex: 1; height: 40px; padding: 8px;" onkeyup="filterRepresentatives()">
                    <button class="btn-search" onclick="filterRepresentatives()" style="height: 40px; white-space: nowrap; padding: 8px 16px;">ğŸ” ê²€ìƒ‰</button>
                </div>
            </div>
            
            <div class="table-wrapper" style="max-height: 350px; overflow-y: auto;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th style="text-align: center">ì„ íƒ</th>
                            <th style="text-align: center">ì´ë¦„</th>
                            <th style="text-align: center">ë³„ëª…</th>
                            <th style="text-align: center">ì „í™”ë²ˆí˜¸</th>
                        </tr>
                    </thead>
                    <tbody id="representativeList">
                        <tr data-name="ê¹€ì² ìˆ˜" data-alias="ì² ìˆ˜" data-phone="010-1234-5678" data-id="EMP001">
                            <td><button class="btn-table-action" onclick="selectRepresentative('ê¹€ì² ìˆ˜', 'EMP001')">ì„ íƒ</button></td>
                            <td>ê¹€ì² ìˆ˜</td>
                            <td>ì² ìˆ˜</td>
                            <td>010-1234-5678</td>
                        </tr>
                        <tr data-name="ì´ì˜í¬" data-alias="ì˜í¬" data-phone="010-2345-6789" data-id="EMP002">
                            <td><button class="btn-table-action" onclick="selectRepresentative('ì´ì˜í¬', 'EMP002')">ì„ íƒ</button></td>
                            <td>ì´ì˜í¬</td>
                            <td>ì˜í¬</td>
                            <td>010-2345-6789</td>
                        </tr>
                        <tr data-name="ë°•ë¯¼ìˆ˜" data-alias="ë¯¼ìˆ˜" data-phone="010-3456-7890" data-id="EMP003">
                            <td><button class="btn-table-action" onclick="selectRepresentative('ë°•ë¯¼ìˆ˜', 'EMP003')">ì„ íƒ</button></td>
                            <td>ë°•ë¯¼ìˆ˜</td>
                            <td>ë¯¼ìˆ˜</td>
                            <td>010-3456-7890</td>
                        </tr>
                        <tr data-name="ì •ìˆ˜ì§„" data-alias="ìˆ˜ì§„" data-phone="010-4567-8901" data-id="EMP004">
                            <td><button class="btn-table-action" onclick="selectRepresentative('ì •ìˆ˜ì§„', 'EMP004')">ì„ íƒ</button></td>
                            <td>ì •ìˆ˜ì§„</td>
                            <td>ìˆ˜ì§„</td>
                            <td>010-4567-8901</td>
                        </tr>
                        <tr data-name="ìµœë™ìš±" data-alias="ë™ìš±" data-phone="010-5678-9012" data-id="EMP005">
                            <td><button class="btn-table-action" onclick="selectRepresentative('ìµœë™ìš±', 'EMP005')">ì„ íƒ</button></td>
                            <td>ìµœë™ìš±</td>
                            <td>ë™ìš±</td>
                            <td>010-5678-9012</td>
                        </tr>
                        <tr data-name="ê°•ì§€í›ˆ" data-alias="ì§€í›ˆ" data-phone="010-6789-0123" data-id="EMP006">
                            <td><button class="btn-table-action" onclick="selectRepresentative('ê°•ì§€í›ˆ', 'EMP006')">ì„ íƒ</button></td>
                            <td>ê°•ì§€í›ˆ</td>
                            <td>ì§€í›ˆ</td>
                            <td>010-6789-0123</td>
                        </tr>
                        <tr data-name="ìœ¤ì„œì—°" data-alias="ì„œì—°" data-phone="010-7890-1234" data-id="EMP007">
                            <td><button class="btn-table-action" onclick="selectRepresentative('ìœ¤ì„œì—°', 'EMP007')">ì„ íƒ</button></td>
                            <td>ìœ¤ì„œì—°</td>
                            <td>ì„œì—°</td>
                            <td>010-7890-1234</td>
                        </tr>
                        <tr data-name="í•œì¬ë¯¼" data-alias="ì¬ë¯¼" data-phone="010-8901-2345" data-id="EMP008">
                            <td><button class="btn-table-action" onclick="selectRepresentative('í•œì¬ë¯¼', 'EMP008')">ì„ íƒ</button></td>
                            <td>í•œì¬ë¯¼</td>
                            <td>ì¬ë¯¼</td>
                            <td>010-8901-2345</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
            <div class="pagination" style="margin-top: 20px;">
                <button class="page-btn" onclick="changeRepPage('prev')">â—€</button>
                <button class="page-btn active" id="rep-page-1" onclick="changeRepPage(1)">1</button>
                <button class="page-btn" id="rep-page-2" onclick="changeRepPage(2)">2</button>
                <button class="page-btn" onclick="changeRepPage('next')">â–¶</button>
            </div>
        </div>
        <div class="modal-footer" style="padding: 20px;">
            <button class="btn-modal-cancel" onclick="closeRepresentativeModal()">ì·¨ì†Œ</button>
        </div>
    </div>
</div>

<script>
    let currentRepPage = 1;
    const itemsPerPage = 5;

    function openRepresentativeModal() {
        document.getElementById('representativeModal').style.display = 'flex';
        document.getElementById('representativeSearch').value = '';
        currentRepPage = 1;
        filterRepresentatives();
    }

    function closeRepresentativeModal() {
        document.getElementById('representativeModal').style.display = 'none';
    }

    function selectRepresentative(name, id) {
        document.getElementById('representativeInput').value = name;
        closeRepresentativeModal();
    }

    function filterRepresentatives() {
        const searchValue = document.getElementById('representativeSearch').value.toLowerCase();
        const searchColumn = document.getElementById('representativeSearchColumn').value;
        const rows = document.querySelectorAll('#representativeList tr');
        let visibleRows = [];
        
        rows.forEach(row => {
            let fieldValue = '';
            if (searchColumn === 'name') {
                fieldValue = row.getAttribute('data-name').toLowerCase();
            } else if (searchColumn === 'alias') {
                fieldValue = row.getAttribute('data-alias').toLowerCase();
            } else if (searchColumn === 'phone') {
                fieldValue = row.getAttribute('data-phone').toLowerCase();
            }
            
            if (fieldValue.includes(searchValue)) {
                visibleRows.push(row);
            }
        });
        
        // í˜ì´ì§€ë„¤ì´ì…˜ ì ìš©
        const totalPages = Math.ceil(visibleRows.length / itemsPerPage);
        const startIdx = (currentRepPage - 1) * itemsPerPage;
        const endIdx = startIdx + itemsPerPage;
        
        rows.forEach(row => row.style.display = 'none');
        visibleRows.forEach((row, idx) => {
            if (idx >= startIdx && idx < endIdx) {
                row.style.display = '';
            }
        });
        
        updateRepPagination(totalPages);
    }

    function changeRepPage(page) {
        const rows = document.querySelectorAll('#representativeList tr');
        const searchValue = document.getElementById('representativeSearch').value.toLowerCase();
        const searchColumn = document.getElementById('representativeSearchColumn').value;
        let visibleCount = 0;
        
        rows.forEach(row => {
            let fieldValue = '';
            if (searchColumn === 'name') {
                fieldValue = row.getAttribute('data-name').toLowerCase();
            } else if (searchColumn === 'alias') {
                fieldValue = row.getAttribute('data-alias').toLowerCase();
            } else if (searchColumn === 'phone') {
                fieldValue = row.getAttribute('data-phone').toLowerCase();
            }
            
            if (fieldValue.includes(searchValue)) {
                visibleCount++;
            }
        });
        
        const totalPages = Math.ceil(visibleCount / itemsPerPage);
        
        if (page === 'prev') {
            if (currentRepPage > 1) currentRepPage--;
        } else if (page === 'next') {
            if (currentRepPage < totalPages) currentRepPage++;
        } else {
            currentRepPage = page;
        }
        
        filterRepresentatives();
    }

    function updateRepPagination(totalPages) {
        const pageButtons = document.querySelectorAll('.pagination .page-btn');
        pageButtons.forEach(btn => {
            if (btn.id && btn.id.startsWith('rep-page-')) {
                const pageNum = parseInt(btn.id.split('-')[2]);
                if (pageNum <= totalPages) {
                    btn.style.display = '';
                    if (pageNum === currentRepPage) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                } else {
                    btn.style.display = 'none';
                }
            }
        });
    }

    window.onclick = function(event) {
        const modal = document.getElementById('representativeModal');
        if (event.target === modal) {
            closeRepresentativeModal();
        }
    }
</script>
{{end}}
