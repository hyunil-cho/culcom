{{define "customers/detail.html"}}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Title}} - ë°±ì˜¤í”¼ìŠ¤</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    {{template "sidebar" .}}
    
    <div class="main-wrapper">
        {{template "header" .}}
        
        <main class="content">
<!-- ì•¡ì…˜ ë²„íŠ¼ -->
<div class="detail-actions">
    <a href="/customers" class="btn-back">â† ëª©ë¡ìœ¼ë¡œ</a>
    <div class="action-group">
        <a href="/customers/edit?id={{.Customer.ID}}" class="btn-primary">âœï¸ ìˆ˜ì •</a>
        <button class="btn-danger" onclick="showDeleteModal('{{.Customer.Name}}', '{{.Customer.ID}}')">ğŸ—‘ï¸ ì‚­ì œ</button>
    </div>
</div>

<!-- ì‚­ì œ í™•ì¸ ëª¨ë‹¬ -->
<div id="deleteModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <span class="modal-icon">âš ï¸</span>
            <h3>ê³ ê° ì‚­ì œ í™•ì¸</h3>
        </div>
        <div class="modal-body">
            <p>ì •ë§ë¡œ <strong id="customerNameToDelete"></strong> ê³ ê°ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
            <p class="warning-text">âš ï¸ ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>
        <div class="modal-footer">
            <button class="btn-modal-cancel" onclick="closeDeleteModal()">ì·¨ì†Œ</button>
            <button class="btn-modal-confirm" onclick="confirmDelete()">ì‚­ì œ</button>
        </div>
    </div>
</div>

<!-- ê³ ê° ìƒì„¸ ì •ë³´ -->
<div class="content-card">
    <div class="detail-header">
        <h2>ê¸°ë³¸ ì •ë³´</h2>
    </div>
    <div class="detail-body">
        <div class="detail-row">
            <div class="detail-label">ê³ ê°ë²ˆí˜¸</div>
            <div class="detail-value">{{.Customer.ID}}</div>
        </div>
        <div class="detail-row">
            <div class="detail-label">ì´ë¦„</div>
            <div class="detail-value"><strong>{{.Customer.Name}}</strong></div>
        </div>
        <div class="detail-row">
            <div class="detail-label">ì „í™”ë²ˆí˜¸</div>
            <div class="detail-value">{{.Customer.Phone}}</div>
        </div>
        <div class="detail-row">
            <div class="detail-label">ì´ë©”ì¼</div>
            <div class="detail-value">{{.Customer.Email}}</div>
        </div>
        <div class="detail-row">
            <div class="detail-label">ìƒíƒœ</div>
            <div class="detail-value">
                <span class="status-badge status-active">{{.Customer.Status}}</span>
            </div>
        </div>
        <div class="detail-row">
            <div class="detail-label">ê°€ì…ì¼</div>
            <div class="detail-value">{{.Customer.RegisterDate}}</div>
        </div>
        <div class="detail-row">
            <div class="detail-label">ìµœê·¼ ë°©ë¬¸</div>
            <div class="detail-value">{{.Customer.LastVisit}}</div>
        </div>
    </div>
</div>

<!-- ì˜ì—… íˆìŠ¤í† ë¦¬ -->
<div class="content-card">
    <div class="detail-header">
        <h2>ì˜ì—… íˆìŠ¤í† ë¦¬</h2>
    </div>
    <div class="detail-body">
        {{if .SalesHistory}}
        <div class="table-wrapper">
            <table class="data-table">
                <thead>
                    <tr>
                        <th style="width: 15%;">ë‚ ì§œ</th>
                        <th style="width: 15%;">ìƒë‹´ì›</th>
                        <th style="width: 50%;">ìƒë‹´ ë‚´ìš©</th>
                        <th style="width: 20%;">ì½”ë©˜íŠ¸</th>
                    </tr>
                </thead>
                <tbody>
                    {{range .SalesHistory}}
                    <tr>
                        <td>{{.Date}}</td>
                        <td>{{.Agent}}</td>
                        <td>
                            <div class="consultation-content">
                                <strong>{{.Content}}</strong>
                                {{if .Detail}}
                                <div class="consultation-detail">{{.Detail}}</div>
                                {{end}}
                            </div>
                        </td>
                        <td>{{.Comment}}</td>
                    </tr>
                    {{end}}
                </tbody>
            </table>
        </div>
        {{else}}
        <div class="empty-state">
            <div class="empty-icon">ğŸ“‹</div>
            <div class="empty-text">ì•„ì§ ì˜ì—… íˆìŠ¤í† ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
            <button class="btn-secondary" onclick="openAddHistoryModal()">ì²« íˆìŠ¤í† ë¦¬ ì¶”ê°€í•˜ê¸°</button>
        </div>
        {{end}}
    </div>
</div>

<!-- íˆìŠ¤í† ë¦¬ ì¶”ê°€ ëª¨ë‹¬ -->
<div id="addHistoryModal" class="modal">
    <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
            <h3>ì˜ì—… íˆìŠ¤í† ë¦¬ ì¶”ê°€</h3>
            <span class="modal-close" onclick="closeAddHistoryModal()">&times;</span>
        </div>
        <div class="modal-body" style="text-align: left;">
            <form id="historyForm">
                <div class="form-group">
                    <label class="form-label">ë‚ ì§œ *</label>
                    <input type="date" class="form-input" name="date" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ìƒë‹´ì› *</label>
                    <input type="text" class="form-input" name="agent" placeholder="ìƒë‹´ì› ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ìƒë‹´ ë‚´ìš© *</label>
                    <input type="text" class="form-input" name="content" placeholder="ìƒë‹´ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ìƒì„¸ ë‚´ìš©</label>
                    <textarea class="form-input" name="detail" rows="3" placeholder="ìƒì„¸ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">ì½”ë©˜íŠ¸</label>
                    <textarea class="form-input" name="comment" rows="2" placeholder="ì½”ë©˜íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn-secondary" onclick="closeAddHistoryModal()">ì·¨ì†Œ</button>
            <button class="btn-primary" onclick="submitHistory()">ì €ì¥</button>
        </div>
    </div>
</div>

<script>
    let customerIdToDelete = null;

    function showDeleteModal(customerName, customerId) {
        customerIdToDelete = customerId;
        document.getElementById('customerNameToDelete').textContent = customerName;
        document.getElementById('deleteModal').style.display = 'flex';
    }

    function closeDeleteModal() {
        document.getElementById('deleteModal').style.display = 'none';
        customerIdToDelete = null;
    }

    function confirmDelete() {
        if (customerIdToDelete) {
            // TODO: ì‹¤ì œ ì‚­ì œ ë¡œì§ êµ¬í˜„
            // window.location.href = '/customers/delete?id=' + customerIdToDelete;
            alert('ì‚­ì œ ê¸°ëŠ¥ì€ ì•„ì§ êµ¬í˜„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
            closeDeleteModal();
        }
    }

    // íˆìŠ¤í† ë¦¬ ì¶”ê°€ ëª¨ë‹¬
    function openAddHistoryModal() {
        // í˜„ì¬ ë‚ ì§œë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        const dateValue = `${year}-${month}-${day}`;
        
        document.querySelector('input[name="date"]').value = dateValue;
        document.getElementById('addHistoryModal').style.display = 'block';
    }

    function closeAddHistoryModal() {
        document.getElementById('addHistoryModal').style.display = 'none';
        document.getElementById('historyForm').reset();
    }

    function submitHistory() {
        const form = document.getElementById('historyForm');
        if (form.checkValidity()) {
            // TODO: ì‹¤ì œ ì €ì¥ ë¡œì§ êµ¬í˜„
            const formData = new FormData(form);
            console.log('Form data:', Object.fromEntries(formData));
            alert('íˆìŠ¤í† ë¦¬ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.\n(ì‹¤ì œ ì €ì¥ ê¸°ëŠ¥ì€ ë°±ì—”ë“œì—ì„œ êµ¬í˜„ í•„ìš”)');
            closeAddHistoryModal();
        } else {
            form.reportValidity();
        }
    }

    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    window.onclick = function(event) {
        const deleteModal = document.getElementById('deleteModal');
        const historyModal = document.getElementById('addHistoryModal');
        
        if (event.target === deleteModal) {
            closeDeleteModal();
        }
        if (event.target === historyModal) {
            closeAddHistoryModal();
        }
    }
</script>
        </main>
    </div>
</body>
</html>
{{end}}
